<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ãƒ¡ãƒ¢ / ã‚¿ã‚¹ã‚¯</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", sans-serif; margin: 24px; }
    .wrap { max-width: 720px; margin: 0 auto; }
    h1 { margin: 0 0 12px; }
    .row { display: flex; gap: 8px; }
    input[type="text"] { flex: 1; padding: 10px; font-size: 16px; }
    button { padding: 10px 12px; font-size: 14px; cursor: pointer; }
    ul { list-style: none; padding: 0; margin: 16px 0 0; }
    li { display: flex; align-items: center; gap: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 10px; margin-bottom: 8px; }
    li.done .text { text-decoration: line-through; opacity: .6; }
    .text { flex: 1; word-break: break-word; }
    .muted { color: #666; font-size: 12px; margin-top: 10px; }
    .danger { border: 1px solid #f0b; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ğŸ“ ãƒ¡ãƒ¢ / ã‚¿ã‚¹ã‚¯</h1>

    <div class="row">
      <input id="input" type="text" placeholder="ä¾‹ï¼šFirebaseå‹‰å¼· 15åˆ† / è²·ã„ç‰© / ãƒ¡ãƒ¼ãƒ«è¿”ã™" />
      <button id="addBtn">è¿½åŠ </button>
    </div>

    <div class="row" style="margin-top:8px;">
      <button id="clearDoneBtn">å®Œäº†ã‚’å‰Šé™¤</button>
      <button id="clearAllBtn" class="danger">å…¨éƒ¨å‰Šé™¤</button>
    </div>

    <ul id="list"></ul>

    <div class="muted">
      â€»ãƒ‡ãƒ¼ã‚¿ã¯ã“ã®ç«¯æœ«ã®ãƒ–ãƒ©ã‚¦ã‚¶å†…ï¼ˆlocalStorageï¼‰ã«ä¿å­˜ã•ã‚Œã¾ã™ï¼ˆç„¡æ–™ãƒ»ã‚µãƒ¼ãƒãƒ¼ä¸è¦ï¼‰
    </div>
  </div>

  <script>
    // --- storage key ---
    var KEY = "memo_tasks_v1";

    // --- state ---
    var tasks = load();

    // --- elements ---
    var input = document.getElementById("input");
    var list = document.getElementById("list");
    var addBtn = document.getElementById("addBtn");
    var clearDoneBtn = document.getElementById("clearDoneBtn");
    var clearAllBtn = document.getElementById("clearAllBtn");

    // --- events ---
    addBtn.addEventListener("click", addTask);
    input.addEventListener("keydown", function(e) {
      if (e.key === "Enter") addTask();
    });

    clearDoneBtn.addEventListener("click", function() {
      tasks = tasks.filter(function(t) { return !t.done; });
      save(tasks);
      render();
    });

    clearAllBtn.addEventListener("click", function() {
      if (!confirm("å…¨éƒ¨æ¶ˆã—ã¾ã™ã€‚ã»ã‚“ã¨ã«OKï¼Ÿ")) return;
      tasks = [];
      save(tasks);
      render();
    });

    // --- functions ---
    function addTask() {
      var text = (input.value || "").trim();
      if (!text) return;

      tasks.unshift({
        id: String(Date.now()) + "_" + Math.random().toString(16).slice(2),
        text: text,
        done: false,
        createdAt: Date.now()
      });

      input.value = "";
      save(tasks);
      render();
    }

    function toggleDone(id) {
      tasks = tasks.map(function(t) {
        if (t.id === id) t.done = !t.done;
        return t;
      });
      save(tasks);
      render();
    }

    function removeTask(id) {
      tasks = tasks.filter(function(t) { return t.id !== id; });
      save(tasks);
      render();
    }

    function render() {
      list.innerHTML = "";

      if (tasks.length === 0) {
        var empty = document.createElement("li");
        empty.innerHTML = '<span class="text">ã¾ã ãƒ¡ãƒ¢ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ä¸Šã®æ¬„ã‹ã‚‰è¿½åŠ ã—ã¦ã¿ã¦ï¼</span>';
        list.appendChild(empty);
        return;
      }

      tasks.forEach(function(t) {
        var li = document.createElement("li");
        if (t.done) li.classList.add("done");

        var chk = document.createElement("input");
        chk.type = "checkbox";
        chk.checked = !!t.done;
        chk.addEventListener("change", function() { toggleDone(t.id); });

        var span = document.createElement("span");
        span.className = "text";
        span.textContent = t.text;

        var del = document.createElement("button");
        del.textContent = "å‰Šé™¤";
        del.addEventListener("click", function() { removeTask(t.id); });

        li.appendChild(chk);
        li.appendChild(span);
        li.appendChild(del);
        list.appendChild(li);
      });
    }

    function load() {
      try {
        var raw = localStorage.getItem(KEY);
        if (!raw) return [];
        var arr = JSON.parse(raw);
        return Array.isArray(arr) ? arr : [];
      } catch (e) {
        return [];
      }
    }

    function save(arr) {
      localStorage.setItem(KEY, JSON.stringify(arr));
    }

    // initial render
    render();
  </script>
</body>
</html>